

Odin以后支持OTG，Osborn和R1，U盘格式支持fat，fat32，不支持exfat格式，有版权费。
===================================================

Failed to install out/target/product/trident/system/priv-app/CalendarSmartisan/CalendarSmartisan.apk: Failure [-26: Package com.android.calendar new target SDK 22 doesn't support runtime permissions but the old target SDK 24 does.]

=================== 文件搜索性能测试 ===========
1，由于输入后没有搜索按钮，所以采取的策略是输入后延时500ms开始搜索，如果500ms内有持续输入则不会搜索。
2，搜索速度涉及的因素很多，搜索的文件首字母，文件系统的总文件数量，以及搜索的策略等。排除搜索的策略差异（各手机厂商的策略不可知，无对比性），如果要测试搜索速度，需按下面的步骤测试：
1），保证两个手机中的总文件数量大致相同，比如都在10w量级左右（这个请测试自己想办法，营造这种测试case，简单的方法是恢复出厂设置后的手机文件数量不多，可以直接往手机中拷贝10w量级的文件来掩盖差异，但切忌不要都在一个文件夹下面）。
2），搜索首字母为A和Z的文件，测试数据。
3），搜索在根目录和在深层次目录中的文件，测试数据。
这个bug关闭处理，请按照上面的方法重新测试。

====================下载失败：==================
1） 宽带劫持/运营商劫持（下载的应用不对，无法安装或者下载失败）——可以通过使用https来解决这个问题
2） 数据源过期未下架 ——云平台清理过期应用
3） 网络类型判断以及isMetered判断在不同安卓版本不同
----android 7 以后使用了proxy，导致某些VPN（比如阿里钱盾）下无法下载，改为之前的方式
----Android 7 个人热点的网络的isMetered返回true，导致无法下载，已做规避。
----Android 8 VPN的isMetered返回true，导致无法下载，已做规避。
4） 域名解析失败问题
Unable to resolve host "api-app.smartisan.com": No address associated with hostname
这个是前端api的域名解析失败，需要发生时间和用户的ip ，报给腾讯云分析,只要是res的地址 就是腾讯云
像这种无法解析地址问题，首先确定用户能否访问外网？如果能应该就是服务器节点的问题
---之前我们为了防流量劫持采用的httpdns的问题，会返回节点给客户端去下载，但是经常会有节点数据丢失的情况，所以已经把httpdns这个去掉了。
5） 重定向次数过多，超过七次。--链接有问题，云平台修改。
---我们自己本身会对下载连接进行判断，如果跳转次数超过3次，就会走我们自己的cdn。但是目前存在劫持情况，可能会劫持到别的链接，所以会导致重定向次数过多，这个上了https会解决一部分
6） https的问题：
---不支持ip节点（Hostname 103.18.208.197 not verified  这类问题, https不支持ip节点，可改为http）
---需要确认系统是否对*.smartisan.com的hppts请求做了根证书校验，根证书有过修改，旧版本会出问题
7) user-agent，下载这边会对每个没有user-agent的链接添加user-agent属性，不同Android版本不一样。
---url后面多了参数的话，cdn缓存就会失效，就会回源去查，导致回源率上升。（user-agent是一个正常属性，cdn那边做过滤）
8) 安装解析失败，看数据报的比较多，但原因未知，不知道是下载的包不对还是下载出了问题还是解析出了问题。
----发现有一些应用宝的包，他们更新接口给我们的下载地址下下来的应用确实无法在商店安装，但是他们自己官网的包就可以安装，md5也不一样。这个问题已经反馈给应用宝了。
----其余的需要应用商店分析
9）jobscheduler的问题
----搜狗浏览器占用了active的slot，导致下载任务无法执行
----好几个任务（包括其他应用的）处于pending状态但一直不执行，osborn上报的比较多
10）网络问题，网络不好或者网络受限，表现为超时或返回其他错误。


=====================闹钟不响：==================
根据目前的日志，闹钟不响主要有以下几类原因：
1, kernel没有回调。需要kernel同事调查。
2, AlarmManagerService的dump信息有deliver时间，但是时钟界面没有拉起来，需要framework同事调查。
3, 回调的闹钟信息是上一次的信息，闹钟判断信息不对就不响（逻辑是过期一段时间的闹钟就不会响了），需要framework同事调查。 ——时钟应用做了规避
4，有界面但没声音 ——media组同事解过几个case了。
5，doze模式导致闹钟不准时 ——应用层已修改用setAlarmClock方法。
6，误操作及其他不明原因：我们看到有两例用户反馈不响但是日志显示闹钟界面起了10s中，media也播放了。

针对第2中情况：
很可能的原因是：root cause是ams pause时activitystack有个成员变量被置空，需要等被pause的activity执行完onpause再回来才会继续，如果应用的onpause出问题就会block，500ms的超时，500ms内闹钟的activity刚好被拉起就是起不来。nexus 6p 8.1也不响，xiaomi 8 SE 8.1没有activity，有notification，铃音播放正常
历史：安卓原生用的是receiver的方式，后来因为出现了闹钟不响的问题，由于receiver优先级比较低容易被杀，二来当广播队列比较多是可能有延时，根据系统组的建议改为了activity。现在与framework同事商讨决定还是改回receiver的方式。

=====================ANR:=====================
除了CPU占用率外，有的进程最后边还有faults信息，该信息来自于proc/%d/stat，表示这段时间该进程发生的minor faults次数和major faults次数。Faults表示发生了缺页异常，如果缺页异常处理中需要访问磁盘或emmc等外设存储设备，那么记录一次major faults，如果仅是分配物理内存那么记录一次minor faults。Major faults对性能影响肯定更大。频繁的申请释放内存会导致minor faults增加。日志形式如下：

3.6% 2719/com.xxx.xxx.xxx: 3% user + 0.6% kernel / faults: 3998 minor 4 major

=====================删除文件性能测试：===========
单个文件删除也不用对比了。
单个文件删除流程很简单：
1, 调用java的file.delete接口删除文件。
2, 做动画完成界面更新。
目前没有反馈删出单个文件特别耗时的问题，否则反案可以改为直接更新界面，后台删除文件，这样从界面根本体现不出删除性能，但是测试还是会看到界面的差异，这种测试就完全没有意义。
文件的删除只要底层的IO性能测试没问题就行了，没必要对比应用中的删除性能。
如果删除一个很大的文件夹出现卡顿，那也跟性能没有关系，只是策略问题而已。
如有问题可以先问金山，都不同意我们再邮件讨论。
